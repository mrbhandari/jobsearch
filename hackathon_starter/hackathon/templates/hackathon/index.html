<!DOCTYPE html>

<html>
    {% include 'hackathon/base.html' %}

    <body>
    <div class="container">
    	{% if user.is_authenticated %}
        	<h1>Api Example</h1>
        	<strong>{{ boldmessage }}</strong><br />
        {% else %}
        	<h1> Find Skills for a Job</h1>
        {% endif %}
    	<br>
		<div class="row">
		    <div class="col-sm-6 col-md-6">
			<form id="jobform" action="skills_api" method="post">
			<div class="form-group">
			    <label for="comment">Paste in a job description ... </label>
			    <textarea class="form-control" rows="10" id="job_desc" name=job_desc></textarea>
			</div>
			<button class="btn btn-primary btn-lg">Find skills for this job</button>
			</form>
		    </div>
			<div class="col-sm-6 col-md-6">
			<label for="comment">... see what skills required</label>
			<div id="result">
			    
			</div>
			</div>		    
		    
		    
		    
		    
		</div>
		<br>
		<div class="row">
			
			<div class="col-sm-6 col-md-6">
				Please send feedback here.
			</div>

		</div>
	</div>
    </body>
    
    <script type="text/javascript">
	$(document).ready(function(){
	    console.log("test");
	    $("#jobform").submit(
				 function (e) {
						console.log("Form submitted")
						e.preventDefault();
						var job_desc =  $( '#job_desc' ).val();
						
						$.ajax({
						    type:"POST",
						    url: "skills_api",
						    dataType : 'string',
						    data: 'job_desc='+encodeURIComponent(job_desc),
						    success: function(data){
							console.log("SUCCESS")
							console.log(data)
						     },
						     error: function(data){
							console.log("FAILURE")
							console.log(jQuery.parseJSON(data.responseText))
							console.log(jQuery.parseJSON(data.responseText).data)
							obj = jQuery.parseJSON(data.responseText).data
							outputHTML = ""
							
							
							
							
							var temp = []; //create array
							for(var k in obj) temp.push({key: k, value: obj[k]});
							var sorted = temp.sort(function(a,b){ return b.value - a.value; });  //sort array
							
							$.each(sorted, function(skill) {
							    console.log(sorted[skill])
							    console.log(sorted[skill].key)
							    outputHTML += '<button class="btn btn-default" type="button">'+ sorted[skill].key +' <span class="badge">'+ sorted[skill].value.toString() + '</span></button><br><br>'
							}); 
							$("#result").html(outputHTML)
							console.log(sorted);  //display array
							
							
							
							
							
							
						     }
						})
					    }
					    
				 )
	    });
    </script>
    
</html>
